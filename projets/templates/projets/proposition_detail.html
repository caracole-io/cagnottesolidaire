{% extends "projets/projet_detail.html" %}

{% block projet_column %}

{% if projet.image %}
<a href="{{ projet.absolute_url }}">
  <img alt="image pour {{ projet }}" src="{{ projet.image.url }}" class="projp-det-im" />
</a>
<hr>
{% endif %}

<h2>{{ proposition.link }}</h2>
<dl class="dl-horizontal">
  <dt>Responsable</dt>       <dd>{{ proposition.responsable.get_full_name }}</dd>
  <dt>Prix Min.</dt>         <dd>{{ proposition.prix }} €</dd>
  <dt>Bénéficiaires max.</dt>     <dd>{{ proposition.ben_str }}</dd>
  <dt>Offres (validées)</dt> <dd>{{ proposition.offres.0 }} ({{ proposition.offres.1 }})</dd>
</dl>

{% endblock %}

{% block projet_content %}
<p>{{ proposition.description }}</p>

{% block proposition_content %}

{% if today <= projet.fin_achat %}
<p class="text-center"><a href="{% url 'projets:offre_create' p_slug=projet.slug slug=proposition.slug %}"
                          type="button" class="btn btn-success btn-large">Faire une offre !</a></p>
{% endif %}

{% if request.user.is_authenticated %}
{% if request.user.is_staff or proposition.responsable == request.user %}
<h2>Offres sur cette proposition</h2>

<table class="table table-stripped">
  <tr>
    <th>Personne</th><th class="text-right">Prix</th>
    <th class="text-right">Validée</th><th class="text-right">Paiement reçu</th>
    <th>TODO</th>
  </tr>
  {% for offre in proposition.offre_set.all %}
  <tr>
    <td>{{ offre.beneficiaire }}</td>
    <td class="text-right">{{ offre.prix }} €</td>
    <td class="text-right">{{ offre.valide|yesno:"oui,non,pas encore" }}</td>
    <td class="text-right">{{ offre.paye|yesno }}</td>
    <td><a href="{% url 'projets:offre' pk=offre.pk %}">go</a></td>
  </tr>
  {% empty %}
  <tr><td colspan="5">Il n’y a pas encore d’offres</td></tr>
  {% endfor %}
</table>
<p>Récolté pour {{ projet.link }}: {{ proposition.somme }} €</p>

{% endif %}
{% endif %}
{% endblock %}
{% endblock %}
