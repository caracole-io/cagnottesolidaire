{% extends "base.html" %}
{% load static humanize %}

{% block content %}

<div class="container">
  <div class="row">
    <div class="col-md-4">
      <h1>Projet: {{ projet.link }}</h1>
      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="{{ projet.somme }}" aria-valuemin="0"
             aria-valuemax="{{ projet.finances}}" style="width: {{ projet.progress }}%; min-width: 3em;">
          {{ projet.somme }} €
        </div>
      </div>
      <dl class="dl-horizontal">
        <dt>Besoins</dt>    <dd>{{ projet.finances|intcomma }} €</dd>
        <dt>Fin Dépôt</dt>   <dd>{{ projet.fin_depot|naturalday }}</dd>
        <dt>Fin Achat</dt>   <dd>{{ projet.fin_achat|naturalday }}</dd>
        <dt>Responsable</dt> <dd>{{ projet.responsable_s }}</dd>
      </dl>
      <p>{{ projet.objectif }}</p>
      {% block projet_column %}
      {% endblock %}
    </div>

    <div class="col-md-8">
      {% if object.image %}
      <a href="{{ object.absolute_url }}">
      <img alt="image pour {{ object }}" src="{{ object.image.url }}" class="projp-det-im" />
      </a>
      {% endif %}

      {% block projet_content %}
      <div class="row">
        <h1>Propositions</h1>

        {% for proposition in projet.proposition_set.all %}
        <div class="col-md-4">
          <div class="projp">
            <a href="{{ proposition.absolute_url }}">
            <img alt="image pour {{ proposition }}" src="{% if proposition.image %}{{ proposition.image.url }}{% else %}{% static 'img/blank.png' %}{% endif %}" />
            </a>
            <h2>{{ proposition.link }}</h2>
            <p class="text-right"><span class="badge">{{ proposition.offres.1 }}</span> / {{ proposition.ben_s }}</p>
            <p class="obj">{{ proposition.description|linebreaksbr|truncatewords:20 }}</p>
            <p class="text-center"><a type="button" class="btn btn-success" href="{{ proposition.absolute_url }}">Go »</a></p>
          </div>
        </div>
        {% if forloop.counter|divisibleby:"3" %}</div><div class="row">{% endif %}
        {% endfor %}

        {% if today <= projet.fin_depot %}
        {% if projet.proposition_set.count|divisibleby:"3" %}</div><div class="row">{% endif %}
        <div class="col-md-4">
          <div class="projp projp-new">
            <a href="{% url 'projets:proposition_create' slug=projet.slug %}">
            <img alt="nouveau projet" src="{% static 'img/new.png' %}" />
            <h2>Nouvelle proposition</h2>
            </a>
            <p class="obj">Vous aussi, participez à cette cagnotte solidaire en proposant un bien ou un service !</p>
            <p class="text-center"><a type="button" class="btn btn-success" href="{% url 'projets:proposition_create' slug=projet.slug %}">Ajouter une proposition »</a></p>
          </div>
        </div>

        {% endif %}

      </div>
      {% endblock %}
    </div>
  </div>
</div>
{% endblock %}
